---
const base = import.meta.env.BASE_URL;

// IMPORTANT (fixes missing images on deploy):
// We render images as `${base}${p.image}` instead of `/images/...` so it works even if your site is deployed in a subfolder.

const products = [
  {
    id: "set-black",
    name: "Black Satin-Look Cami & Shorts Set",
    price: 400,
    image: "images/set-black.png",
    colors: ["Black"],
    sizes: ["S", "M", "L"],
    defaultColor: "Black",
  },
  {
    id: "set-white",
    name: "White Satin-Look Cami & Shorts Set",
    price: 400,
    image: "images/set-white.png",
    colors: ["White"],
    sizes: ["S", "M", "L"],
    defaultColor: "White",
  },
  {
    id: "nude-slip",
    name: "Nude Satin-Look Slip Dress",
    price: 400,
    image: "images/nude-slipp-dress.png", // <-- matches your filename
    colors: ["Nude"],
    sizes: ["S", "M", "L"],
    defaultColor: "Nude",
  },
  {
    id: "white-slip",
    name: "White Satin-Look Slip Dress",
    price: 499,
    image: "images/white-slip-dress.png",
    colors: ["White"],
    sizes: ["S", "M", "L"],
    defaultColor: "White",
  },
  {
    id: "black-chemise",
    name: "Black Satin-Look Chemise Dress",
    price: 499,
    image: "images/black-chemise.png",
    colors: ["Black"],
    sizes: ["S", "M", "L"],
    defaultColor: "Black",
  },

  // Bras
  {
    id: "white-soft-bra",
    name: "White Soft Comfort Bra",
    price: 350,
    image: "images/white-soft-bra.png",
    colors: ["White"],
    sizes: ["75B", "80B", "85B", "90B", "95B"],
    defaultColor: "White",
  },
  {
    id: "black-soft-bra",
    name: "Black Soft Comfort Bra",
    price: 350,
    image: "images/black-soft-bra.png",
    colors: ["Black"],
    sizes: ["75B", "80B", "85B", "90B", "95B"],
    defaultColor: "Black",
  },
  {
    id: "grey-soft-bra",
    name: "Grey Soft Comfort Bra",
    price: 350,
    image: "images/grey-soft.png", // <-- matches your filename
    colors: ["Grey"],
    sizes: ["75B", "80B", "85B", "90B", "95B"],
    defaultColor: "Grey",
  },

  // If you want these shown as products too (they exist in your folder):
  {
    id: "white-sport-bra",
    name: "White Sport Bra",
    price: 350,
    image: "images/white-sport-bra.png",
    colors: ["White"],
    sizes: ["S", "M", "L"],
    defaultColor: "White",
  },
  {
    id: "white-set-bra",
    name: "White Set Bra",
    price: 350,
    image: "images/white-set-bra.png",
    colors: ["White"],
    sizes: ["S", "M", "L"],
    defaultColor: "White",
  },
];
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Amic Underwear</title>

    <style>
      :root{
        --bg:#f7f6f4;
        --text:#151515;
        --muted:#6b6b6b;
        --border:#dedede;
        --card:#ffffff;
      }
      *{ box-sizing:border-box; }
      body{
        margin:0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background:var(--bg);
        color:var(--text);
      }

      header{
        padding:26px 44px;
        display:flex;
        justify-content:space-between;
        align-items:center;
      }
      .brand{
        font-weight:800;
        letter-spacing:.08em;
        text-transform:uppercase;
        font-size:18px;
      }
      nav{
        display:flex;
        gap:26px;
        align-items:center;
      }
      nav a{
        color:var(--text);
        text-decoration:none;
        font-size:16px;
        font-weight:500;
      }
      nav a:hover{ text-decoration:underline; }

      .badge{
        display:inline-flex;
        align-items:center;
        justify-content:center;
        min-width:22px;
        height:22px;
        padding:0 6px;
        border-radius:999px;
        border:1px solid var(--border);
        font-size:12px;
        color:var(--muted);
        background:#fff;
        margin-left:8px;
      }

      main{
        max-width:1200px;
        margin:0 auto;
        padding:0 44px 80px;
      }

      .hero{
        margin-top:110px;
        max-width:900px;
      }
      .hero h1{
        margin:0 0 18px;
        font-size:72px;
        line-height:1.05;
        letter-spacing:-0.02em;
      }
      .hero p{
        margin:0;
        color:var(--muted);
        font-size:20px;
        max-width:680px;
      }

      .sectionTitle{
        margin-top:90px;
        font-size:22px;
        font-weight:700;
      }

      .products{
        margin-top:18px;
        display:grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap:24px;
      }
      .card{
        background:var(--card);
        border:1px solid var(--border);
        padding:16px;
      }
      .card img{
        width:100%;
        height:420px;
        object-fit:cover;
        background:#eee;
        border:1px solid var(--border);
        display:block;
      }

      .name{
        margin:12px 0 4px;
        font-size:18px;
        font-weight:700;
      }
      .price{
        margin:0 0 10px;
        font-weight:800;
      }

      .label{
        margin:12px 0 8px;
        color:var(--muted);
        font-size:12px;
        text-transform:uppercase;
        letter-spacing:.06em;
      }
      .grid{
        display:grid;
        grid-template-columns: repeat(2, 1fr);
        gap:10px;
      }
      .opt{
        border:1px solid var(--border);
        background:#fff;
        padding:12px 10px;
        cursor:pointer;
        text-align:center;
        font-size:15px;
      }
      .opt.active{
        border-color:var(--text);
        outline:2px solid rgba(0,0,0,.06);
      }

      .qty{
        display:grid;
        grid-template-columns: 56px 70px 56px;
        border:1px solid var(--border);
        width:max-content;
      }
      .qty button{
        border:0;
        background:#fff;
        padding:12px 0;
        cursor:pointer;
        font-size:18px;
      }
      .qty div{
        display:flex;
        align-items:center;
        justify-content:center;
        border-left:1px solid var(--border);
        border-right:1px solid var(--border);
        font-size:14px;
      }

      .actions{
        display:grid;
        grid-template-columns: 1fr 1fr;
        gap:10px;
        margin-top:14px;
      }
      .btn{
        padding:12px 10px;
        border:1px solid var(--text);
        background:#fff;
        cursor:pointer;
        font-size:14px;
        font-weight:700;
      }
      .btn.primary{
        background:var(--text);
        color:#fff;
      }
      .btn.secondary{
        border-color:var(--border);
        font-weight:700;
      }
      .msg{
        margin:10px 0 0;
        font-size:12px;
        min-height:16px;
        color:#1a7f37;
      }
      .msg.bad{ color:#b42318; }

      @media (max-width: 900px){
        header{ padding:18px 18px; }
        main{ padding:0 18px 60px; }
        .hero{ margin-top:70px; }
        .hero h1{ font-size:48px; }
      }
    </style>
  </head>

  <body>
    <header>
      <div class="brand">AMIC UNDERWEAR</div>
      <nav>
        <a href="#shop">Shop</a>
        <a href="https://wa.me/4792928373" target="_blank" rel="noopener">Contact</a>
        <a href={`${base}checkout/`}>
          Checkout <span class="badge" id="cartCount">0</span>
        </a>
      </nav>
    </header>

    <main>
      <section class="hero">
        <h1>Everyday comfort.<br />Designed beautifully.</h1>
        <p>
          Amic Underwear creates soft, supportive essentials designed to move with your body —
          made for confidence, comfort, and real life.
        </p>
      </section>

      <h2 id="shop" class="sectionTitle">Shop</h2>

      <section class="products" aria-label="Products">
        {products.map((p) => (
          <article
            class="card"
            data-product
            data-id={p.id}
            data-name={p.name}
            data-price={p.price}
          >
            <img src={`${base}${p.image}`} alt={p.name} loading="lazy" />

            <div class="name">{p.name}</div>
            <div class="price">{p.price} NOK</div>

            <div class="label">Size</div>
            <div class="grid sizes">
              {p.sizes.map((s) => (
                <button class="opt" type="button" data-size={s}>{s}</button>
              ))}
            </div>

            <div class="label">Color</div>
            <div class="grid colors">
              {p.colors.map((c) => (
                <button
                  class={`opt ${c === p.defaultColor ? "active" : ""}`}
                  type="button"
                  data-color={c}
                >
                  {c}
                </button>
              ))}
            </div>

            <div class="label">Quantity</div>
            <div class="qty" role="group" aria-label="Quantity selector">
              <button type="button" data-minus>-</button>
              <div data-qty>1</div>
              <button type="button" data-plus>+</button>
            </div>

            <div class="actions">
              <button class="btn secondary" type="button" data-remove>Remove</button>
              <button class="btn primary" type="button" data-add>Add to cart</button>
            </div>

            <p class="msg" data-msg></p>
          </article>
        ))}
      </section>
    </main>

    <script>
      const CART_KEY = "amicbridge_cart_v1";

      function readCart() {
        try { return JSON.parse(localStorage.getItem(CART_KEY) || "[]"); }
        catch { return []; }
      }
      function writeCart(cart) {
        localStorage.setItem(CART_KEY, JSON.stringify(cart));
        updateCartCount();
      }
      function updateCartCount() {
        const count = readCart().reduce((sum, i) => sum + (Number(i.qty) || 0), 0);
        const el = document.getElementById("cartCount");
        if (el) el.textContent = String(count);
      }
      function setMsg(card, text, ok=true){
        const el = card.querySelector("[data-msg]");
        if(!el) return;
        el.textContent = text;
        el.classList.toggle("bad", !ok);
      }

      document.querySelectorAll("[data-product]").forEach((card) => {
        let qty = 1;
        let size = null;
        let color = card.querySelector(".colors .opt.active")?.dataset.color || null;

        // Size
        card.querySelectorAll(".sizes .opt").forEach((b) => {
          b.addEventListener("click", () => {
            card.querySelectorAll(".sizes .opt").forEach((x) => x.classList.remove("active"));
            b.classList.add("active");
            size = b.dataset.size;
            setMsg(card, "");
          });
        });

        // Color
        card.querySelectorAll(".colors .opt").forEach((b) => {
          b.addEventListener("click", () => {
            card.querySelectorAll(".colors .opt").forEach((x) => x.classList.remove("active"));
            b.classList.add("active");
            color = b.dataset.color;
            setMsg(card, "");
          });
        });

        // Quantity
        const qtyEl = card.querySelector("[data-qty]");
        card.querySelector("[data-plus]").addEventListener("click", () => {
          qty = Math.min(99, qty + 1);
          qtyEl.textContent = String(qty);
        });
        card.querySelector("[data-minus]").addEventListener("click", () => {
          qty = Math.max(1, qty - 1);
          qtyEl.textContent = String(qty);
        });

        // Add to cart
        card.querySelector("[data-add]").addEventListener("click", () => {
          if (!size) return setMsg(card, "Please select a size.", false);
          if (!color) return setMsg(card, "Please select a color.", false);

          const cart = readCart();
          const productId = card.dataset.id;
          const name = card.dataset.name;
          const price = Number(card.dataset.price) || 0;

          const existing = cart.find(i => i.productId === productId && i.size === size && i.color === color);
          if (existing) existing.qty += qty;
          else cart.push({ productId, name, price, size, color, qty });

          writeCart(cart);
          setMsg(card, "Added to cart ✓");
        });

        // Remove from cart (removes the exact size+color item)
        card.querySelector("[data-remove]").addEventListener("click", () => {
          if (!size || !color) return setMsg(card, "Select size & color to remove.", false);

          let cart = readCart();
          const before = cart.length;

          cart = cart.filter(
            (i) => !(i.productId === card.dataset.id && i.size === size && i.color === color)
          );

          if (cart.length === before) return setMsg(card, "Item not in cart.", false);

          writeCart(cart);
          setMsg(card, "Removed from cart ✓");
        });
      });

      updateCartCount();
    </script>
  </body>
</html>

